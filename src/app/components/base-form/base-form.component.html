<form
  (ngSubmit)="onSubmit()"
  [formGroup]="form"
  class="p-fluid"
>
  <div
    *ngFor="let field of entityFields"
    class="field"
  >
    <label class="block font-semibold mb-2" for="{{field.name}}"> {{ fieldLabel(field.name) }} </label>

    <ng-container [ngSwitch]="field.type">
      <ng-container *ngSwitchCase="MT.INTEGER">
        <p-inputNumber
          [useGrouping]="false"
          class="w-full"
          formControlName="{{ field.name }}"
          id="{{field.name}}"
          mode="decimal"
        />
      </ng-container>
      <ng-container *ngSwitchCase="MT.FLOAT">
        <p-inputNumber
          [maxFractionDigits]="5"
          [minFractionDigits]="1"
          [useGrouping]="false"
          class="w-full"
          formControlName="{{ field.name }}"
          id="{{field.name}}"
          mode="decimal"
        />
      </ng-container>
      <ng-container *ngSwitchCase="MT.STRING">
        <input
          class="w-full"
          formControlName="{{ field.name }}"
          id="{{field.name}}"
          pInputText
        />
      </ng-container>
      <ng-container *ngSwitchCase="MT.DATE">
        <p-calendar
          class="w-full"
          formControlName="{{ field.name }}"
          id="{{field.name}}"
        />
      </ng-container>
      <ng-container *ngSwitchCase="MT.ENUM">
        <p-dropdown
          [loading]="!relEnums[field.name]"
          [options]="relEnums[field.name]"
          class="w-full"
          formControlName="{{ field.name }}"
          id="{{field.name}}"
        />
      </ng-container>
      <ng-container *ngSwitchCase="MT.REL">
        <p-dropdown
          [loading]="!relEntities[field.name]"
          [options]="relEntities[field.name]"
          class="w-full"
          formControlName="{{ field.name }}"
          id="{{field.name}}"
          optionLabel="{{meta.getEntity(field.entityRef!).titleField}}"
        />
      </ng-container>
    </ng-container>
    <small
      *ngIf="!field.nullable && !field.readonly"
      [class]="!form.value[field.name] ? 'text-red-500' : ''">
      Required
    </small>
  </div>

  <div class="flex justify-content-end gap-2 mt-3">
    <p-button
      [disabled]="!form.valid"
      label="Save"
      type="submit"
    />
  </div>
</form>
